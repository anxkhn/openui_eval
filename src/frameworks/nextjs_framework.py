"""Next.js 15 framework implementation."""

from pathlib import Path
from typing import Any, Dict, List

from .base_framework import BaseFramework


class NextJSFramework(BaseFramework):
    """Next.js 15 framework implementation."""

    def __init__(self):
        super().__init__("Next.js", "15.0.0")

    def get_project_template(self) -> Dict[str, str]:
        """Get Next.js project template files."""
        return {
            "next.config.js": """/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  experimental: {
    appDir: true,
  },
}

module.exports = nextConfig""",
            "app/layout.js": """import './globals.css'

export const metadata = {
  title: 'Next.js App',
  description: 'Generated by create-next-app',
}

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}""",
            "app/globals.css": """html,
body {
  padding: 0;
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen,
    Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;
}

a {
  color: inherit;
  text-decoration: none;
}

* {
  box-sizing: border-box;
}

@media (prefers-color-scheme: dark) {
  html {
    color-scheme: dark;
  }
  body {
    color: white;
    background: black;
  }
}""",
            ".gitignore": """# Dependencies
node_modules/
.pnp
.pnp.js

# Testing
coverage/

# Next.js
.next/
out/

# Production
build/

# Environment variables
.env*.local

# Vercel
.vercel

# TypeScript
*.tsbuildinfo
next-env.d.ts

# IDE
.vscode/
.idea/

# OS
.DS_Store
Thumbs.db""",
            "README.md": """# Next.js App

This is a [Next.js](https://nextjs.org/) project.

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.
""",
            "jsconfig.json": """{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./app/*"]
    }
  }
}""",
        }

    def get_package_json(self) -> Dict[str, Any]:
        """Get Next.js package.json configuration."""
        return {
            "name": "nextjs-app",
            "version": "0.1.0",
            "private": True,
            "scripts": {
                "dev": "next dev",
                "build": "next build",
                "start": "next start",
                "lint": "next lint",
            },
            "dependencies": {
                "react": "^19.0.0",
                "react-dom": "^19.0.0",
                "next": "^15.0.0",
            },
            "devDependencies": {"eslint": "^8.57.0", "eslint-config-next": "^15.0.0"},
            "engines": {"node": ">=22.0.0"},
        }

    def get_build_command(self) -> List[str]:
        """Get Next.js build command."""
        return ["npm", "run", "build"]

    def get_dev_command(self) -> List[str]:
        """Get Next.js dev server command."""
        return ["npm", "run", "dev"]

    def get_install_command(self) -> List[str]:
        """Get dependency installation command."""
        return ["npm", "install"]

    @property
    def default_port(self) -> int:
        """Next.js dev server default port."""
        return 3000

    @property
    def build_dir(self) -> str:
        """Next.js build output directory."""
        return ".next"

    def _add_port_to_command(self, cmd: List[str], port: int) -> List[str]:
        """Add port configuration to Next.js dev command."""
        if "dev" in cmd:
            return cmd + ["-p", str(port)]
        return cmd

    def _validate_framework_specific(self, project_dir: Path) -> List[str]:
        """Validate Next.js-specific requirements."""
        errors = []

        # Check for required Next.js files
        required_files = ["next.config.js", "app/layout.js", "app/page.js"]

        for file_path in required_files:
            if not (project_dir / file_path).exists():
                errors.append(f"Required Next.js file missing: {file_path}")

        return errors

    def create_page_component(self, component_content: str) -> str:
        """Create the main page component."""
        return f"""export default function Home() {{
  return (
    <main>
      {component_content}
    </main>
  )
}}"""

    def create_page_css(self, css_content: str = "") -> str:
        """Create page-specific CSS module."""
        base_css = """.main {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
  padding: 6rem;
  min-height: 100vh;
}

.description {
  display: inherit;
  justify-content: inherit;
  align-items: inherit;
  font-size: 0.85rem;
  max-width: var(--max-width);
  width: 100%;
  z-index: 2;
  font-family: var(--font-mono);
}"""

        if css_content:
            return base_css + "\n\n" + css_content
        return base_css
